<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./styles/normalize.css">
    <link rel="stylesheet" href="./styles/icons.css">
    <link rel="stylesheet" href="./styles/base.css">
    <link rel="stylesheet" href="./styles/layout.css">
    <title>JASON TEST DATA</title>
      <script id="restaurants-template" type="text/x-handlebars-template">
       
        <div id="rst-top-level">
            <div id="img-info">
                <div id="rst-img">
                   <img id ="featured-image" src={{"featured_image"}}>   
                </div>                 
            </div>

        <div id="rst-info"> 
            <p id="rst-name">{{name}}</p> 
            <p id="locality">{{locality_verbose}}</p>
            <p id="address">Address: {{address}}</p>
        </div>          

        <div id ="detail">          
            <p id="rating">{{aggregate_rating}}</p>
            <p id="votes">{{votes}} </p>
        </div>
        
        
        <div id="more-info"> 
            CUISINES: {{cuisines}}
            <br>
            COST FOR TWO: ${{average_cost_for_two}}</p> 
        </div>   
        
        <div id="menu">
            <a href="{{menu_url}}">Menu</a>
        </div>
        

        </div>
            
       
   
       

        <!-- <p> rating_color= {{rating_color}}</p>
        <p> rating_text {{rating_text}}</p> -->
        
        <hr>
    </div>
      </script>
</head>
<body>
    <div id="detail-view"></div>
    <div id="restaurants-container"></div>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
    <script src="scripts/models/rst.js"></script>
        <script>
            var est = '',
                userCoord = '';
            navigator.geolocation.getCurrentPosition(function(position) {
                console.log('position.coords.latitude',position.coords.latitude,'position.coords.longitude',position.coords.longitude);
              userCoord = {
                  long: position.coords.longitude,
                  lat: position.coords.latitude
              }
              console.log('userCoord lat',userCoord.lat,'userCoord long',userCoord.long);
              $.post('http://localhost:3000/api/v2.1/geocode',userCoord)
                .then(function(data){
                    var res = JSON.parse(data)
                    console.log('results',res.nearby_restaurants)
                    Neighborhood.all = new Neighborhood(res.location);
                    Popularity.all = new Popularity(res.popularity.top_cuisines)
                    for(index in res.nearby_restaurants){
                        NearbyRes.all.push(new NearbyRes(res.nearby_restaurants[index].restaurant))
                    }
                    NearbyRes.all.forEach(a => $('#restaurants-container').append(a.toHtml()));

                    function getID(id){
                        for(index in NearbyRes.all){console.log(NearbyRes.all[index].id)}

                        for(index in NearbyRes.all){
                            if(id == NearbyRes.all[index].id){
                                // Grab the template script
                                var theTemplateScript = $("#detail-template").html();
                                var theTemplate = Handlebars.compile(theTemplateScript);
 
                                var theCompiledHtml = theTemplate(NearbyRes.all[index]);

                                // Add the compiled html to the page
                                $('#detail-view').html(theCompiledHtml);
                            }
                        }
                    }
                    getID('16720700');


                })
                .catch(function(err){ console.error(err)});

                
            });
          </script>

</body>
</html>
